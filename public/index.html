<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SKSK ProTech ‚Äì AI Auto Estimator [BETA]</title>
<style>
* { margin:0; padding:0; box-sizing:border-box }
body { 
  background:#000; 
  color:#fff; 
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  padding:1rem;
  max-width:900px;
  margin:0 auto;
  line-height:1.6
}
input,textarea,select,button { 
  width:100%; 
  padding:.7rem; 
  margin:.4rem 0; 
  background:#111; 
  color:#fff; 
  border:1px solid #333; 
  border-radius:8px; 
  font-size:1rem;
  font-family:inherit
}
input:focus,textarea:focus { outline:none; border-color:#dc2626 }
button { 
  background:#dc2626; 
  font-weight:600; 
  cursor:pointer; 
  border:2px solid #b91c1c;
  transition:all 0.2s
}
button:hover:not(:disabled) { background:#b91c1c; transform:translateY(-1px) }
button:disabled { opacity:.5; cursor:not-allowed }
.card { 
  background:#111; 
  border:1px solid #27272a; 
  border-radius:12px; 
  padding:1.2rem; 
  margin-bottom:1rem;
  box-shadow:0 4px 20px rgba(0,0,0,0.5)
}
.header { text-align:center; padding:1.5rem 0 }
.logo { 
  font-size:2.5rem; 
  font-weight:800; 
  letter-spacing:0.05em;
  background:linear-gradient(135deg,#dc2626,#ef4444);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  margin-bottom:.5rem
}
.beta-badge { 
  display:inline-block;
  background:#ef4444;
  color:#000;
  padding:.2rem .6rem;
  border-radius:4px;
  font-size:.7rem;
  font-weight:700;
  margin-left:.5rem;
  letter-spacing:0.05em
}
.tagline { color:#9ca3af; font-size:.95rem; margin:.3rem 0 }
.subtitle { color:#6b7280; font-size:.85rem; font-style:italic }
h2 { margin-bottom:.8rem; font-size:1.3rem }
h3 { margin-bottom:.4rem; font-size:1.1rem; color:#e5e7eb }
label { 
  display:block; 
  font-size:.8rem; 
  color:#9ca3af; 
  margin-bottom:.3rem;
  font-weight:500
}
small { font-size:.75rem; color:#6b7280; display:block; margin-top:.2rem }
.quick-rate { display:flex; gap:.3rem; margin-top:.4rem }
.quick-btn { 
  flex:1; 
  padding:.5rem; 
  font-size:.75rem; 
  background:#020617; 
  border:1px solid #374151;
  cursor:pointer;
  transition:all 0.2s
}
.quick-btn:hover { border-color:#dc2626; color:#f9fafb; transform:translateY(-1px) }
.error,.success { 
  padding:.6rem; 
  border-radius:8px; 
  margin:.5rem 0; 
  font-size:.85rem;
  display:none
}
.error { background:#dc262625; border:1px solid #dc2626; color:#fca5a5 }
.success { background:#22c55e25; border:1px solid #22c55e; color:#bbf7d0 }
.spinner { 
  display:inline-block; 
  width:16px; 
  height:16px; 
  border:2px solid #fff; 
  border-top-color:transparent; 
  border-radius:50%; 
  animation:spin 0.8s linear infinite 
}
@keyframes spin { to { transform:rotate(360deg) } }
.info-box { 
  background:#020617; 
  border:1px solid #27272a; 
  padding:.7rem; 
  border-radius:8px; 
  margin-bottom:.6rem 
}
.part-row { 
  display:flex; 
  justify-content:space-between; 
  font-size:.9rem; 
  margin:.3rem 0;
  color:#d1d5db
}
.part-row.total { 
  border-top:1px solid #374151; 
  padding-top:.4rem; 
  margin-top:.4rem; 
  font-weight:600;
  color:#e5e7eb
}
.total-box { 
  background:linear-gradient(90deg,#dc2626,#b91c1c); 
  padding:1rem; 
  border-radius:10px; 
  display:flex; 
  justify-content:space-between; 
  font-weight:700; 
  font-size:1.1rem;
  margin:.8rem 0;
  box-shadow:0 4px 12px rgba(220,38,38,0.3)
}
.tax-box { 
  border:1px solid #fbbf24; 
  background:rgba(251,191,36,0.08); 
  padding:.7rem; 
  border-radius:8px; 
  font-size:.85rem 
}
.tax-row { 
  display:flex; 
  justify-content:space-between; 
  margin:.2rem 0; 
  color:#fef08a 
}
.tax-row.takehome { 
  border-top:1px solid #fbbf24; 
  padding-top:.4rem; 
  margin-top:.4rem; 
  font-weight:600; 
  color:#fefce8 
}
.support-box { 
  background:linear-gradient(135deg,#1e293b,#0f172a);
  border:1px solid #334155;
  padding:1.2rem;
  border-radius:12px;
  text-align:center;
  margin:1.5rem 0
}
.support-title { 
  font-size:1.1rem;
  font-weight:600;
  color:#e5e7eb;
  margin-bottom:.5rem
}
.support-text { 
  color:#94a3b8;
  font-size:.85rem;
  margin-bottom:1rem;
  line-height:1.5
}
.cashapp-btn { 
  display:inline-block;
  background:#00d632;
  color:#000;
  padding:.8rem 1.5rem;
  border-radius:8px;
  text-decoration:none;
  font-weight:700;
  font-size:1rem;
  transition:all 0.2s;
  border:none;
  cursor:pointer;
  box-shadow:0 4px 12px rgba(0,214,50,0.3)
}
.cashapp-btn:hover { 
  background:#00bf2d; 
  transform:translateY(-2px);
  box-shadow:0 6px 16px rgba(0,214,50,0.4)
}
.footer { 
  text-align:center; 
  padding:2rem 0 1rem; 
  color:#6b7280; 
  font-size:.75rem;
  border-top:1px solid #27272a;
  margin-top:2rem
}
.footer a { color:#9ca3af; text-decoration:none }
.footer a:hover { color:#dc2626 }
</style>
</head>
<body>

<!-- HEADER -->
<div class="header">
  <div class="logo">
    SKSK ProTech
    <span class="beta-badge">BETA</span>
  </div>
  <div class="tagline">AI-Powered Auto Estimator for Mobile Mechanics</div>
  <div class="subtitle">Testing Phase ‚Ä¢ Features Added as Development Continues</div>
</div>

<!-- MAIN FORM -->
<div class="card">
  <h2>üìã Job Estimate</h2>
  
  <label>Customer Name *</label>
  <input id="customerName" placeholder="John Smith" required>
  
  <label>Phone</label>
  <input id="customerPhone" type="tel" placeholder="330-555-1212">
  
  <label>Email</label>
  <input id="customerEmail" type="email" placeholder="customer@example.com">
  
  <label>Vehicle</label>
  <input id="vehicle" placeholder="2008 Ford F-150 5.4L V8">
  
  <label>Your Labor Rate ($/hr)</label>
  <div style="display:flex; align-items:center; gap:.4rem">
    <span style="color:#22c55e; font-size:1.3rem">$</span>
    <input id="laborRate" type="number" value="65" min="0" max="200" step="5" style="max-width:110px">
    <span style="color:#9ca3af; font-size:.9rem">/hr</span>
  </div>
  <div class="quick-rate">
    <button class="quick-btn" data-rate="45">Friends $45</button>
    <button class="quick-btn" data-rate="65">Standard $65</button>
    <button class="quick-btn" data-rate="90">Premium $90</button>
  </div>
  <small>Adjust per job: Friends (40-50) ‚Ä¢ Standard (50-75) ‚Ä¢ Premium (75-100)</small>

  <label>Job Description *</label>
  <textarea id="description" placeholder="Example: Water pump replacement, front brake pads and rotors" rows="4" required></textarea>

  <div id="errorBox" class="error"></div>
  <div id="successBox" class="success"></div>

  <button id="submitBtn">‚ö° Generate Estimate</button>
</div>

<!-- ESTIMATE DISPLAY -->
<div class="card">
  <h2>üí∞ Estimate</h2>
  <div id="estimateDisplay">
    <p style="color:#6b7280; text-align:center; padding:2rem">
      No estimate yet. Fill out job details above and hit Generate.
    </p>
  </div>
</div>

<!-- SUPPORT BOX -->
<div class="support-box">
  <div class="support-title">üíô Voluntary Support</div>
  <div class="support-text">
    This tool is 100% free, no signup required.<br>
    If it saved you time and you'd like to help with<br>
    server costs, any amount is appreciated but never expected.
  </div>
  <a href="https://cash.app/$Punter613" target="_blank" class="cashapp-btn">
    üíµ Support via Cash App
  </a>
  <div style="margin-top:.8rem; font-size:.75rem; color:#64748b">
    Built in spare time ‚Ä¢ Shared for free
  </div>
</div>

<!-- FOOTER -->
<div class="footer">
  <div style="margin-bottom:.5rem">
    <strong style="color:#9ca3af">About This Tool</strong>
  </div>
  <div style="max-width:600px; margin:0 auto; line-height:1.6">
    Built by a former mechanic living with vision loss and chronic migraines.
    Can't work regular hours anymore, but on good days I tinker with code.
    This started as a way to stay connected to the trade.
  </div>
  <div style="margin-top:1rem; padding-top:1rem; border-top:1px solid #27272a">
    Beta Version ‚Ä¢ Features added irregularly as health permits<br>
    ¬© 2024 SKSK ProTech ‚Ä¢ <a href="#" id="aboutLink">FAQ</a>
  </div>
</div>

<!-- ABOUT MODAL (hidden by default) -->
<div id="aboutModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:999; padding:2rem; overflow-y:auto">
  <div class="card" style="max-width:600px; margin:2rem auto">
    <h2>‚ùì FAQ</h2>
    
    <h3 style="margin-top:1rem">Who made this?</h3>
    <p style="color:#9ca3af; font-size:.9rem">
      A mechanic who can't turn wrenches anymore but still loves the trade.
    </p>
    
    <h3 style="margin-top:1rem">Why is it free?</h3>
    <p style="color:#9ca3af; font-size:.9rem">
      Because mechanics helped me when I needed it. Paying it forward.
    </p>
    
    <h3 style="margin-top:1rem">How can I help?</h3>
    <p style="color:#9ca3af; font-size:.9rem">
      Use it. Share it with other mechanics. If you want to chip in for 
      hosting costs, cool. If not, that's cool too.
    </p>
    
    <h3 style="margin-top:1rem">Will you add [feature]?</h3>
    <p style="color:#9ca3af; font-size:.9rem">
      Maybe! On good days I tinker with it. No promises on timing due to 
      health issues (migraines, light sensitivity). Features get added when I'm able.
    </p>
    
    <h3 style="margin-top:1rem">Is my data private?</h3>
    <p style="color:#9ca3af; font-size:.9rem">
      Yes. Estimates are stored temporarily. No tracking, no selling data.
    </p>
    
    <button id="closeAbout" style="margin-top:1rem">Close</button>
  </div>
</div>

<script>
const BACKEND_URL = location.hostname === "localhost" 
  ? "http://localhost:4000" 
  : "https://p613-backend.onrender.com";

const errorBox = document.getElementById("errorBox");
const successBox = document.getElementById("successBox");
const submitBtn = document.getElementById("submitBtn");
const estimateDisplay = document.getElementById("estimateDisplay");
const aboutModal = document.getElementById("aboutModal");
const aboutLink = document.getElementById("aboutLink");
const closeAbout = document.getElementById("closeAbout");

function formatCurrency(amt) {
  return new Intl.NumberFormat("en-US", {style:"currency", currency:"USD"}).format(amt || 0);
}

// Quick rate buttons
document.querySelectorAll(".quick-btn").forEach(btn => {
  btn.onclick = () => {
    document.getElementById("laborRate").value = btn.getAttribute("data-rate");
  };
});

// About modal
aboutLink.onclick = (e) => {
  e.preventDefault();
  aboutModal.style.display = "block";
};
closeAbout.onclick = () => {
  aboutModal.style.display = "none";
};

// Generate estimate
submitBtn.onclick = async () => {
  errorBox.style.display = "none";
  successBox.style.display = "none";

  const name = customerName.value.trim();
  const desc = description.value.trim();
  
  if(!name || !desc){
    errorBox.textContent = "Customer name and job description required";
    errorBox.style.display = "block";
    return;
  }

  const payload = {
    customer: {
      name: customerName.value,
      phone: customerPhone.value,
      email: customerEmail.value
    },
    vehicle: vehicle.value,
    description: desc,
    laborRate: Number(laborRate.value) || 65
  };

  submitBtn.disabled = true;
  submitBtn.innerHTML = '<span class="spinner"></span> Generating...';
  estimateDisplay.innerHTML = '<div style="text-align:center; padding:2rem"><div class="spinner" style="width:40px; height:40px; border-width:3px"></div><p style="margin-top:1rem; color:#9ca3af">AI building estimate...</p></div>';

  try {
    const res = await fetch(`${BACKEND_URL}/api/generate-estimate`, {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify(payload)
    });

    const data = await res.json();
    if(!data.ok) throw new Error(data.error || "Failed");

    displayEstimate(data.estimate);
    successBox.textContent = "‚úÖ Estimate generated successfully";
    successBox.style.display = "block";
  } catch(err) {
    errorBox.textContent = err.message || "Connection error. Try again.";
    errorBox.style.display = "block";
    estimateDisplay.innerHTML = '<p style="color:#6b7280; text-align:center; padding:2rem">Failed to generate. Try again.</p>';
  } finally {
    submitBtn.disabled = false;
    submitBtn.innerHTML = "‚ö° Generate Estimate";
  }
};

function displayEstimate(est) {
  const laborRate = est.laborRate || 65;
  const laborHours = est.laborHours || 0;
  const laborCost = est.laborCost ?? (laborHours * laborRate);
  const partsCost = est.partsCost || 0;
  const suppliesPercent = est.shopSuppliesPercent ?? 7;
  const shopSupplies = est.shopSupplies ?? ((laborCost + partsCost) * (suppliesPercent / 100));
  const subtotal = est.subtotal ?? (laborCost + partsCost + shopSupplies);
  const taxSetAside = subtotal * 0.28;
  const takeHome = subtotal - taxSetAside;

  const partsHTML = Array.isArray(est.parts) && est.parts.length > 0
    ? `<div class="info-box">
        <h3>Parts</h3>
        ${est.parts.map(p => `<div class="part-row"><span>${p.name}</span><span>${formatCurrency(p.cost || 0)}</span></div>`).join("")}
        <div class="part-row total">
          <span>Parts Total</span><span>${formatCurrency(partsCost)}</span>
        </div>
      </div>`
    : "";

  const tipsHTML = Array.isArray(est.tips) && est.tips.length
    ? `<div class="info-box" style="border-color:#22c55e">
        <h3 style="color:#86efac">üí° Pro Tips</h3>
        <ul style="color:#bbf7d0; font-size:.85rem; padding-left:1.2rem">${est.tips.map(t => `<li>${t}</li>`).join("")}</ul>
      </div>`
    : "";

  const warningsHTML = Array.isArray(est.warnings) && est.warnings.length
    ? `<div class="info-box" style="border-color:#dc2626">
        <h3 style="color:#fecaca">‚ö†Ô∏è Watch For</h3>
        <ul style="color:#fecaca; font-size:.85rem; padding-left:1.2rem">${est.warnings.map(w => `<li>${w}</li>`).join("")}</ul>
      </div>`
    : "";

  estimateDisplay.innerHTML = `
    <div class="info-box">
      <h3>${est.jobType || "Repair"}</h3>
      <p style="color:#9ca3af; font-size:.9rem">${est.shortDescription || "AI-generated estimate"}</p>
    </div>

    <div class="info-box">
      <h3>Labor</h3>
      <div class="part-row">
        <span>${laborHours.toFixed(1)} hrs @ ${formatCurrency(laborRate)}/hr</span>
        <span>${formatCurrency(laborCost)}</span>
      </div>
    </div>

    ${partsHTML}

    <div class="info-box">
      <div class="part-row">
        <span>Shop Supplies (${suppliesPercent}%)</span>
        <span>${formatCurrency(shopSupplies)}</span>
      </div>
    </div>

    ${tipsHTML}
    ${warningsHTML}

    <div class="total-box">
      <span>Total Estimate</span>
      <span>${formatCurrency(subtotal)}</span>
    </div>

    <div class="tax-box">
      <div style="margin-bottom:.5rem; font-weight:600; color:#fde047">üí∞ Tax Set-Aside (for you only)</div>
      <div class="tax-row">
        <span>Job Total</span>
        <span>${formatCurrency(subtotal)}</span>
      </div>
      <div class="tax-row">
        <span>Set aside ~28% for taxes</span>
        <span>-${formatCurrency(taxSetAside)}</span>
      </div>
      <div class="tax-row takehome">
        <span>Your Take-Home (after tax stash)</span>
        <span>${formatCurrency(takeHome)}</span>
      </div>
      <small style="color:#fef08a; margin-top:.4rem">This never shows on customer invoices - for your tax planning only.</small>
    </div>
  `;
}
</script>
</body>
  </html>
